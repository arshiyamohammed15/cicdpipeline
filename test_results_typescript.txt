
> zeroui-2.0@2.0.0 test:typescript
> npm run build:typescript && npm run test:storage --maxWorkers=4


> zeroui-2.0@2.0.0 build:typescript
> tsc -p tsconfig.config.json && npm run verify:infra-config


> zeroui-2.0@2.0.0 verify:infra-config
> powershell -ExecutionPolicy Bypass -File scripts/di_config_verify.ps1


=== DI Config Verification ===
Environments to verify: 4

  development ... PASS
  integration ... PASS
  staging ... PASS
  production ... PASS

=== PASS Matrix ===

  Environment  Status  Reason
  ---------------------------------------------------------------------
  development  PASS  Configuration loaded successfully
  integration  PASS  Configuration loaded successfully
  staging      PASS  Configuration loaded successfully
  production   PASS  Configuration loaded successfully

Summary: 4/4 PASSED, 0/4 FAILED

PASS: All environments validated successfully

> zeroui-2.0@2.0.0 test:storage
> jest --config jest.config.js --testPathPattern=storage

PASS src/edge-agent/shared/storage/__tests__/ReceiptGenerator.test.ts (7.774 s)
  ReceiptGenerator
    Constructor
      ÔêÜ should create generator with privateKey option (20 ms)
      ÔêÜ should create generator with privateKeyPath option (29 ms)
      ÔêÜ should create generator with EDGE_AGENT_SIGNING_KEY env var (40 ms)
      ÔêÜ should create generator with EDGE_AGENT_SIGNING_KEY_PATH env var (134 ms)
      ÔêÜ should throw error when no key provided (93 ms)
      ÔêÜ should use default keyId when not provided (61 ms)
    generateDecisionReceipt() - Required Fields
      ÔêÜ should generate receipt with all required fields (18 ms)
      ÔêÜ should generate receipt with valid signature (7 ms)
      ÔêÜ should generate unique receipt IDs (6 ms)
      ÔêÜ should accept all evaluation_point values (8 ms)
      ÔêÜ should accept all decision status values (17 ms)
      ÔêÜ should set degraded flag correctly (4 ms)
    generateDecisionReceipt() - Optional Fields: actor.type (TR-6.2)
      ÔêÜ should generate receipt without actor.type (4 ms)
      ÔêÜ should generate receipt with actor.type = "human" (7 ms)
      ÔêÜ should generate receipt with actor.type = "ai" (4 ms)
      ÔêÜ should generate receipt with actor.type = "automated" (4 ms)
      ÔêÜ should include machine_fingerprint when provided (26 ms)
    generateDecisionReceipt() - Optional Fields: context (TR-1.2.3)
      ÔêÜ should generate receipt without context (11 ms)
      ÔêÜ should generate receipt with context.surface = "ide" (4 ms)
      ÔêÜ should generate receipt with context.surface = "pr" (3 ms)
      ÔêÜ should generate receipt with context.surface = "ci" (4 ms)
      ÔêÜ should generate receipt with context.branch (6 ms)
      ÔêÜ should generate receipt with context.commit (4 ms)
      ÔêÜ should generate receipt with context.pr_id (4 ms)
      ÔêÜ should generate receipt with all context fields (4 ms)
    generateDecisionReceipt() - Optional Fields: override (TR-3.2)
      ÔêÜ should generate receipt without override (4 ms)
      ÔêÜ should generate receipt with override (required fields) (8 ms)
      ÔêÜ should generate receipt with override including override_id (4 ms)
    generateDecisionReceipt() - Optional Fields: data_category (TR-4.4)
      ÔêÜ should generate receipt without data_category (4 ms)
      ÔêÜ should generate receipt with data_category = "public" (3 ms)
      ÔêÜ should generate receipt with data_category = "internal" (3 ms)
      ÔêÜ should generate receipt with data_category = "confidential" (3 ms)
      ÔêÜ should generate receipt with data_category = "restricted" (4 ms)
    generateDecisionReceipt() - All Optional Fields Combined
      ÔêÜ should generate receipt with all optional fields (15 ms)
    generateFeedbackReceipt()
      ÔêÜ should generate feedback receipt with all required fields (6 ms)
      ÔêÜ should accept all pattern_id values (5 ms)
      ÔêÜ should accept all choice values (4 ms)
      ÔêÜ should include machine_fingerprint when provided (4 ms)
      ÔêÜ should generate valid signature for feedback receipt (5 ms)
      ÔêÜ should generate unique feedback IDs (4 ms)

  console.error
    Failed to parse receipt line: SyntaxError: Unexpected token 'i', "invalid json line" is not valid JSON

      106 |             } catch (error) {
      107 |                 // Invalid receipt line - log and continue (per Rule 219: invalid lines go to quarantine)
    > 108 |                 console.error(`Failed to parse receipt line: ${error}`);
          |                         ^
      109 |                 // TODO: Move to quarantine directory
      110 |             }
      111 |         }

      at ReceiptStorageReader.readReceipts (src/vscode-extension/shared/storage/ReceiptStorageReader.ts:108:25)
      at Object.<anonymous> (src/vscode-extension/shared/storage/__tests__/ReceiptStorageReader.test.ts:134:43)

  console.error
    Failed to read receipt file: C:/Users/pc/AppData/Local/Temp/zeroui-test-1767841128290/ide/receipts/test-repo-id/2025/01/receipts.jsonl Error: EISDIR: illegal operation on a directory, read
        at Object.readFileSync (node:fs:441:20)
        at ReceiptStorageReader.readReceipts (D:\Projects\ZeroUI2.1\src\vscode-extension\shared\storage\ReceiptStorageReader.ts:72:26)
        at Object.<anonymous> (D:\Projects\ZeroUI2.1\src\vscode-extension\shared\storage\__tests__\ReceiptStorageReader.test.ts:168:43)
        at Promise.then.completed (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\run.js:252:3)
        at _runTestsForDescribeBlock (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\run.js:126:9)
        at _runTestsForDescribeBlock (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\run.js:121:9)
        at _runTestsForDescribeBlock (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\run.js:121:9)
        at run (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\run.js:71:3)
        at runAndTransformResultsToJestFormat (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at jestAdapter (D:\Projects\ZeroUI2.1\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at runTestInternal (D:\Projects\ZeroUI2.1\node_modules\jest-runner\build\runTest.js:367:16)
        at runTest (D:\Projects\ZeroUI2.1\node_modules\jest-runner\build\runTest.js:444:34)
        at Object.worker (D:\Projects\ZeroUI2.1\node_modules\jest-runner\build\testWorker.js:106:12) {
      errno: -4068,
      code: 'EISDIR',
      syscall: 'read'
    }

      72 |             content = fs.readFileSync(receiptFile, 'utf-8');
      73 |         } catch (error) {
    > 74 |             console.error(`Failed to read receipt file: ${receiptFile}`, error);
         |                     ^
      75 |             return [];
      76 |         }
      77 |

      at ReceiptStorageReader.readReceipts (src/vscode-extension/shared/storage/ReceiptStorageReader.ts:74:21)
      at Object.<anonymous> (src/vscode-extension/shared/storage/__tests__/ReceiptStorageReader.test.ts:168:43)

PASS src/edge-agent/shared/storage/__tests__/PolicyStorageService.test.ts (9.125 s)
  PolicyStorageService
    Cache Policy (Rule 221)
      ÔêÜ should cache policy snapshot (333 ms)
      ÔêÜ should reject policy without signature (Rule 221) (100 ms)
      ÔêÜ should reject policy with missing signature (13 ms)
      ÔêÜ should store policy with signature (40 ms)
      ÔêÜ should create directory structure if it does not exist (31 ms)
    Read Cached Policy
      ÔêÜ should return null if policy does not exist (8 ms)
      ÔêÜ should read cached policy (344 ms)
      ÔêÜ should throw error if cached policy missing signature (240 ms)
    Current Policy Version Management
      ÔêÜ should return null if current version not set (4 ms)
      ÔêÜ should set and read current policy version (36 ms)
      ÔêÜ should update current policy version (37 ms)
      ÔêÜ should create directory structure for current pointer (14 ms)
      ÔêÜ should store timestamp with current version (332 ms)
    Code/PII Detection (Rule 217)
      ÔêÜ should reject policy containing function code (254 ms)
      ÔêÜ should reject policy containing class code (120 ms)
      ÔêÜ should accept policy without code (152 ms)

PASS src/vscode-extension/shared/storage/__tests__/ReceiptStorageReader.test.ts (9.235 s)
  ReceiptStorageReader
    Read Receipts
      ÔêÜ should return empty array if file does not exist (83 ms)
      ÔêÜ should read receipts from JSONL file (266 ms)
      ÔêÜ should handle invalid receipt lines gracefully (436 ms)
      ÔêÜ should filter out receipts without signatures (62 ms)
      ÔêÜ should handle file read errors gracefully (83 ms)
    Read Receipts In Range
      ÔêÜ should read receipts within date range (79 ms)
      ÔêÜ should handle receipts across multiple months (388 ms)
    Read Latest Receipts
      ÔêÜ should return latest receipts sorted by timestamp (247 ms)
      ÔêÜ should limit results to specified number (300 ms)
      ÔêÜ should return empty array if no receipts exist (43 ms)
    Signature Validation (Rule 224)
      ÔêÜ should accept receipts with valid signature format (90 ms)
      ÔêÜ should reject receipts without signature (54 ms)

PASS src/edge-agent/shared/storage/__tests__/StoragePathResolver.test.ts
  StoragePathResolver (Edge Agent)
    Constructor
      ÔêÜ should initialize with ZU_ROOT from environment variable (2 ms)
      ÔêÜ should initialize with provided ZU_ROOT parameter (1 ms)
      ÔêÜ should throw error if ZU_ROOT is not set (62 ms)
      ÔêÜ should normalize Windows paths to forward slashes
      ÔêÜ should normalize Unix paths correctly (1 ms)
    Plane Path Resolution
      ÔêÜ should resolve IDE plane path (3 ms)
      ÔêÜ should resolve Tenant plane path (1 ms)
      ÔêÜ should resolve Product plane path (2 ms)
      ÔêÜ should resolve Shared plane path (1 ms)
      ÔêÜ should handle paths with leading/trailing slashes (1 ms)
    Kebab-Case Validation (Rule 216)
      ÔêÜ should accept valid kebab-case repo-id (1 ms)
      ÔêÜ should reject repo-id with uppercase letters (2 ms)
      ÔêÜ should reject repo-id with underscores (2 ms)
      ÔêÜ should reject repo-id with spaces (3 ms)
      ÔêÜ should reject repo-id with special characters (9 ms)
      ÔêÜ should accept repo-id with numbers (1 ms)
      ÔêÜ should reject invalid plane names (2 ms)
    Receipt Path Resolution (Rule 228)
      ÔêÜ should resolve receipt path with YYYY/MM partitioning (1 ms)
      ÔêÜ should pad month to 2 digits (1 ms)
      ÔêÜ should handle month 12 (1 ms)
      ÔêÜ should reject year less than 2000 (2 ms)
      ÔêÜ should reject year greater than 9999 (2 ms)
      ÔêÜ should accept year 2000 (1 ms)
      ÔêÜ should accept year 9999 (2 ms)
      ÔêÜ should reject month less than 1 (2 ms)
      ÔêÜ should reject month greater than 12 (1 ms)
      ÔêÜ should accept month 1 (1 ms)
      ÔêÜ should accept month 12 (1 ms)
    Policy Path Resolution
      ÔêÜ should resolve IDE policy cache path (1 ms)
      ÔêÜ should resolve IDE policy root path
      ÔêÜ should resolve Product policy registry path
      ÔêÜ should resolve Product policy registry root path (39 ms)
    Path Normalization
      ÔêÜ should normalize multiple slashes (2 ms)
      ÔêÜ should handle mixed separators on Windows (1 ms)

PASS tests/vscode-extension/shared/storage/PlanExecutionAgent.infra-labels.spec.ts (10.247 s)
  PlanExecutionAgent Infra Labels
    ÔêÜ should add infra labels to DecisionReceipt when BuildPlan has cost_profile (630 ms)
    ÔêÜ should add infra labels for ai-inference cost_profile (217 ms)
    ÔêÜ should add infra labels for batch cost_profile (187 ms)
    ÔêÜ should extend existing labels object without overwriting (908 ms)

PASS src/edge-agent/shared/storage/__tests__/ReceiptGenerator.signature.test.ts
  ReceiptGenerator Signature Implementation
    ÔêÜ signs decision receipts with Ed25519 (10 ms)
    ÔêÜ signs feedback receipts with Ed25519 (6 ms)
    ÔêÜ canonical JSON sorts keys recursively (6 ms)
    ÔêÜ tampering invalidates signatures (78 ms)
    ÔêÜ different receipts yield different signatures (8 ms)
    ÔêÜ signature encodes key id and base64 payload (6 ms)
    ÔêÜ signature excludes signature field from canonical payload (6 ms)

  console.warn
    Receipt signature verification failed (non-strict mode, stored anyway)

      249 |                 throw new Error('Receipt signature verification failed');
      250 |             }
    > 251 |             console.warn('Receipt signature verification failed (non-strict mode, stored anyway)');
          |                     ^
      252 |         }
      253 |     }
      254 |

      at ReceiptStorageService.verifyReceiptSignature (src/edge-agent/shared/storage/ReceiptStorageService.ts:251:21)
      at ReceiptStorageService.storeDecisionReceipt (src/edge-agent/shared/storage/ReceiptStorageService.ts:62:14)
      at Object.<anonymous> (src/edge-agent/shared/storage/__tests__/integration.test.ts:91:17)

PASS src/vscode-extension/shared/storage/__tests__/StoragePathResolver.test.ts
  StoragePathResolver (VS Code Extension)
    Constructor
      ÔêÜ should initialize with ZU_ROOT from environment variable (3 ms)
      ÔêÜ should initialize with provided ZU_ROOT parameter (1 ms)
      ÔêÜ should use VS Code configuration if environment variable not set (3 ms)
      ÔêÜ should prioritize provided parameter over environment variable (2 ms)
      ÔêÜ should throw error if ZU_ROOT is not set anywhere (112 ms)
    Receipt Path Resolution
      ÔêÜ should resolve receipt path with YYYY/MM partitioning (2 ms)
      ÔêÜ should validate kebab-case repo-id (11 ms)
      ÔêÜ should validate year range (7 ms)
      ÔêÜ should validate month range (3 ms)
    PSCL Temporary Directory Resolution
      ÔêÜ should create PSCL directory under the IDE plane (7 ms)
      ÔêÜ should be idempotent across repeated calls (8 ms)
    Path Normalization
      ÔêÜ should normalize Windows paths (1 ms)
      ÔêÜ should normalize multiple slashes (1 ms)

  console.warn
    Receipt signature verification failed (non-strict mode, stored anyway)

      249 |                 throw new Error('Receipt signature verification failed');
      250 |             }
    > 251 |             console.warn('Receipt signature verification failed (non-strict mode, stored anyway)');
          |                     ^
      252 |         }
      253 |     }
      254 |

      at ReceiptStorageService.verifyReceiptSignature (src/edge-agent/shared/storage/ReceiptStorageService.ts:251:21)
      at ReceiptStorageService.storeDecisionReceipt (src/edge-agent/shared/storage/ReceiptStorageService.ts:62:14)
      at Object.<anonymous> (src/edge-agent/shared/storage/__tests__/integration.test.ts:91:17)

  console.warn
    Receipt signature verification failed (non-strict mode, stored anyway)

      249 |                 throw new Error('Receipt signature verification failed');
      250 |             }
    > 251 |             console.warn('Receipt signature verification failed (non-strict mode, stored anyway)');
          |                     ^
      252 |         }
      253 |     }
      254 |

      at ReceiptStorageService.verifyReceiptSignature (src/edge-agent/shared/storage/ReceiptStorageService.ts:251:21)
      at ReceiptStorageService.storeDecisionReceipt (src/edge-agent/shared/storage/ReceiptStorageService.ts:62:14)
      at Object.<anonymous> (src/edge-agent/shared/storage/__tests__/integration.test.ts:91:17)

PASS src/vscode-extension/shared/storage/__tests__/PlanVerifier.test.ts
  PlanVerifier
    ÔêÜ returns ok=true when plan artifacts match workspace state (95 ms)
    ÔêÜ reports hash mismatch when workspace file differs (107 ms)
    ÔêÜ reports missing artifacts when plan files are absent (9 ms)

  console.warn
    Receipt signature verification failed (non-strict mode, stored anyway)

      249 |                 throw new Error('Receipt signature verification failed');
      250 |             }
    > 251 |             console.warn('Receipt signature verification failed (non-strict mode, stored anyway)');
          |                     ^
      252 |         }
      253 |     }
      254 |

      at ReceiptStorageService.verifyReceiptSignature (src/edge-agent/shared/storage/ReceiptStorageService.ts:251:21)
      at ReceiptStorageService.storeDecisionReceipt (src/edge-agent/shared/storage/ReceiptStorageService.ts:62:14)
      at Object.<anonymous> (src/edge-agent/shared/storage/__tests__/integration.test.ts:91:17)

  console.warn
    Receipt signature verification failed (non-strict mode, stored anyway)

      249 |                 throw new Error('Receipt signature verification failed');
      250 |             }
    > 251 |             console.warn('Receipt signature verification failed (non-strict mode, stored anyway)');
          |                     ^
      252 |         }
      253 |     }
      254 |

      at ReceiptStorageService.verifyReceiptSignature (src/edge-agent/shared/storage/ReceiptStorageService.ts:251:21)
      at ReceiptStorageService.storeDecisionReceipt (src/edge-agent/shared/storage/ReceiptStorageService.ts:62:14)
      at Object.<anonymous> (src/edge-agent/shared/storage/__tests__/integration.test.ts:91:17)

PASS src/vscode-extension/shared/storage/__tests__/PreCommitDecisionService.test.ts
  PreCommitDecisionService
    ÔêÜ returns unknown when no receipts are available (7 ms)
    ÔêÜ extracts snapshot details and diff candidate from latest receipt (14 ms)
    ÔêÜ handles invalid status, label-based artifact id, and string mismatches (3 ms)
    ÔêÜ returns unknown status and logs when reader throws (2 ms)

PASS src/edge-agent/shared/storage/__tests__/ReceiptStorageService.test.ts (12.418 s)
  ReceiptStorageService
    Store Decision Receipt (Rule 219: JSONL)
      ÔêÜ should store decision receipt in JSONL format (402 ms)
      ÔêÜ should append multiple receipts (append-only) (79 ms)
      ÔêÜ should use YYYY/MM partitioning (Rule 228) (32 ms)
      ÔêÜ creates a new monthly file without touching previous months (737 ms)
    Store Feedback Receipt
      ÔêÜ should store feedback receipt in JSONL format (77 ms)
    Signature Validation (Rule 224)
      ÔêÜ should reject receipt without signature (494 ms)
      ÔêÜ should reject receipt with empty signature (79 ms)
      ÔêÜ should accept receipt with valid signature (29 ms)
    Code/PII Detection (Rule 217)
      ÔêÜ should reject receipt containing function code (27 ms)
      ÔêÜ should reject receipt containing class code (382 ms)
      ÔêÜ should reject receipt containing import statement (295 ms)
      ÔêÜ should reject receipt containing email (PII) (378 ms)
      ÔêÜ should reject receipt containing SSN (PII) (270 ms)
      ÔêÜ should accept receipt without code or PII (539 ms)
    Read Receipts
      ÔêÜ should return empty array if file does not exist (7 ms)
      ÔêÜ should read stored receipts (83 ms)
      ÔêÜ should read multiple receipts (241 ms)
    Canonical JSON Format
      ÔêÜ should store receipt without signature field in canonical form (647 ms)
    Directory Creation
      ÔêÜ should create directory structure if it does not exist (474 ms)

PASS src/vscode-extension/shared/storage/__tests__/PSCLArtifactWriter.test.ts
  PSCLArtifactWriter
    ÔêÜ writes FileEnvelope and BuildPlan with deterministic hashes (206 ms)
    ÔêÜ propagates MISSING snapshot id when reader cannot find value (138 ms)

  console.warn
    Receipt signature verification failed (non-strict mode, stored anyway)

      249 |                 throw new Error('Receipt signature verification failed');
      250 |             }
    > 251 |             console.warn('Receipt signature verification failed (non-strict mode, stored anyway)');
          |                     ^
      252 |         }
      253 |     }
      254 |

      at ReceiptStorageService.verifyReceiptSignature (src/edge-agent/shared/storage/ReceiptStorageService.ts:251:21)
      at ReceiptStorageService.storeDecisionReceipt (src/edge-agent/shared/storage/ReceiptStorageService.ts:62:14)
      at Object.<anonymous> (src/edge-agent/shared/storage/__tests__/integration.test.ts:121:13)

  console.warn
    Receipt signature verification failed (non-strict mode, stored anyway)

      249 |                 throw new Error('Receipt signature verification failed');
      250 |             }
    > 251 |             console.warn('Receipt signature verification failed (non-strict mode, stored anyway)');
          |                     ^
      252 |         }
      253 |     }
      254 |

      at ReceiptStorageService.verifyReceiptSignature (src/edge-agent/shared/storage/ReceiptStorageService.ts:251:21)
      at ReceiptStorageService.storeDecisionReceipt (src/edge-agent/shared/storage/ReceiptStorageService.ts:62:14)
      at Object.<anonymous> (src/edge-agent/shared/storage/__tests__/integration.test.ts:122:13)

PASS src/edge-agent/shared/storage/__tests__/PolicyStorageService.getActivePolicyInfo.test.ts (12.977 s)
  PolicyStorageService.getActivePolicyInfo()
    Single Policy Case
      ÔêÜ should return policy info for single existing policy (330 ms)
      ÔêÜ should format policy version ID correctly (policy_id-version) (200 ms)
      ÔêÜ should return snapshot hash in correct format (sha256:hex) (61 ms)
    Multiple Policies Case
      ÔêÜ should return policy info for multiple existing policies (351 ms)
      ÔêÜ should combine snapshot hashes deterministically (sorted) (310 ms)
      ÔêÜ should produce same hash regardless of policy order (sorted hashes) (585 ms)
      ÔêÜ should correctly combine multiple snapshot hashes using SHA-256 (378 ms)
    Empty Policies Case
      ÔêÜ should return empty arrays when no policies are found (11 ms)
      ÔêÜ should return empty arrays when no current version is set (241 ms)
      ÔêÜ should return empty arrays when policy exists but version does not match (326 ms)
    Non-existent Policies
      ÔêÜ should handle non-existent policy IDs gracefully (5 ms)
      ÔêÜ should skip non-existent policies and return existing ones (400 ms)
    Default Parameter Handling
      ÔêÜ should use default policy ID when no policyIds provided (283 ms)
      ÔêÜ should return empty arrays when default policy does not exist (15 ms)
    Edge Cases
      ÔêÜ should handle empty policyIds array (7 ms)
      ÔêÜ should handle policy with empty snapshot hash (85 ms)
      ÔêÜ should handle policy with very long snapshot hash (259 ms)
      ÔêÜ should handle policy IDs with special characters (kebab-case) (59 ms)
      ÔêÜ should handle multiple policies with same hash (should still combine) (204 ms)
    Policy Version ID Format Validation
      ÔêÜ should format policy version IDs correctly for all policies (516 ms)
    Snapshot Hash Determinism
      ÔêÜ should produce identical hash for identical policy sets (135 ms)
      ÔêÜ should produce same hash regardless of input order (sorted internally) (641 ms)

PASS src/vscode-extension/shared/storage/__tests__/PolicySnapshotReader.test.ts
  PolicySnapshotReader (VS Code Extension)
    ÔêÜ returns snapshot id from cached policy (49 ms)
    ÔêÜ returns snapshot id from pointer when present (12 ms)
    ÔêÜ falls back to environment variable when cache missing (3 ms)
    ÔêÜ returns MISSING when no sources available (3 ms)

  console.log
    Registered module: security

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: cache

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: hybrid

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: inference

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: models

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: resources

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: security

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: cache

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: hybrid

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: inference

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: models

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Registered module: resources

      at AgentOrchestrator.registerModule (src/edge-agent/core/AgentOrchestrator.ts:10:17)

  console.log
    Delegating task: test

      at DelegationManager.delegate (src/edge-agent/core/DelegationManager.ts:29:17)

  console.log
    Hybrid Orchestrator processing task: test-task-001

      at HybridOrchestrator.delegate (src/edge-agent/modules/hybrid-orchestrator/HybridOrchestrator.ts:26:21)

PASS src/vscode-extension/shared/storage/__tests__/ReceiptStorageService.test.ts
  ReceiptStorageService WORM continuity
    ÔêÜ maintains receipts across PSCL enabled/disabled toggles (224 ms)
    ÔêÜ creates new monthly file without modifying previous month (194 ms)

  console.log
    Hybrid Orchestrator completed task: test-task-001

      at HybridOrchestrator.delegate (src/edge-agent/modules/hybrid-orchestrator/HybridOrchestrator.ts:53:21)

  console.log
    Validating result...

      at ValidationCoordinator.validate (src/edge-agent/core/ValidationCoordinator.ts:27:17)

  console.log
    Validation result: PASSED

      at ValidationCoordinator.validate (src/edge-agent/core/ValidationCoordinator.ts:77:17)

PASS src/vscode-extension/shared/storage/__tests__/receipts.first-use.create-if-missing.spec.ts
  receipts.first-use.create-if-missing
    ÔêÜ creates file on first write and appends subsequently (349 ms)

PASS src/vscode-extension/shared/storage/__tests__/ReceiptVerifier.canon.test.ts
  ReceiptVerifier canonicalisation
    ÔêÜ produces identical canonical buffers regardless of field ordering (4 ms)
    ÔêÜ matches signer canonicalisation (6 ms)
    ÔêÜ produces stable buffers and omits signature field (6 ms)

PASS src/vscode-extension/shared/storage/__tests__/receipts.append-only.green.spec.ts
  receipts.append-only.green
    ÔêÜ appends lines without altering the existing prefix (597 ms)

PASS src/vscode-extension/shared/storage/__tests__/receipts.feature-flag.off-noop.spec.ts
  receipts.feature-flag.off-noop
    ÔêÜ does not modify receipts during PSCL disable periods (1050 ms)
    ÔêÜ preserves receipt file inode and prefix across OFFÔåÆONÔåÆOFF toggles (1007 ms)

PASS src/vscode-extension/shared/storage/__tests__/ReceiptStorageReader.verify.integration.test.ts
  ReceiptStorageReader signature verification integration
    ÔêÜ returns only receipts with valid signatures (127 ms)

PASS src/vscode-extension/shared/storage/__tests__/BuildSandbox.test.ts
  BuildSandbox
    ÔêÜ produces deterministic digests for identical inputs (100 ms)
    ÔêÜ placeholder SBOM digest lists files when no sbom.json present (106 ms)
    ÔêÜ uses sbom.json content when present (78 ms)

PASS src/edge-agent/shared/storage/__tests__/integration.test.ts (15.029 s)
  Storage Integration Tests
    Receipt Flow: Generate -> Store -> Read
      ÔêÜ should complete full receipt flow (278 ms)
      ÔêÜ should handle multiple receipts in same month (1549 ms)
      ÔêÜ should handle receipts across different months (778 ms)
    Edge Agent Integration
      ÔêÜ should integrate with EdgeAgent storage services (82 ms)
      ÔêÜ should process task and generate receipt (834 ms)
    Cross-Tier Integration
      ÔêÜ should store receipt in Edge Agent and read in VS Code Extension (583 ms)
      ÔêÜ should maintain receipt integrity across tiers (429 ms)

PASS src/vscode-extension/shared/storage/__tests__/ReceiptVerifier.ed25519.test.ts
  ReceiptVerifier Ed25519 interoperability
    ÔêÜ verifies signer output and rejects tampered receipts (10 ms)

PASS src/edge-agent/shared/storage/__tests__/DataCategoryClassifier.test.ts
  DataCategoryClassifier
    ÔêÜ returns explicit category when valid (2 ms)
    ÔêÜ prioritizes secrets and pii as restricted (1 ms)
    ÔêÜ falls back to confidential when sensitive
    ÔêÜ defaults to internal when no signals provided

PASS src/vscode-extension/shared/storage/__tests__/PlanExecutionAgent.test.ts (7.8 s)
  PlanExecutionAgent
    ÔêÜ produces PASS receipt when all checks succeed (3956 ms)
    ÔêÜ produces FAIL receipt when digests mismatch (78 ms)

Test Suites: 24 passed, 24 total
Tests:       207 passed, 207 total
Snapshots:   0 total
Time:        16.621 s
Ran all test suites matching /storage/i.
