{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "KeyMetadata",
  "description": "Key metadata schema per KMS spec Data Schemas section",
  "type": "object",
  "required": [
    "tenant_id",
    "environment",
    "plane",
    "key_id",
    "key_type",
    "key_usage",
    "public_key",
    "key_state",
    "created_at",
    "valid_from",
    "valid_until",
    "rotation_count",
    "access_policy"
  ],
  "properties": {
    "tenant_id": {
      "type": "string",
      "description": "Tenant identifier"
    },
    "environment": {
      "type": "string",
      "enum": ["dev", "staging", "prod"]
    },
    "plane": {
      "type": "string",
      "enum": ["laptop", "tenant", "product", "shared"]
    },
    "key_id": {
      "type": "string",
      "description": "Key identifier (UUID)"
    },
    "key_type": {
      "type": "string",
      "enum": ["RSA-2048", "Ed25519", "AES-256"]
    },
    "key_usage": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["sign", "verify", "encrypt", "decrypt"]
      },
      "minItems": 1
    },
    "public_key": {
      "type": "string",
      "description": "PEM-encoded public key"
    },
    "key_state": {
      "type": "string",
      "enum": ["active", "pending_rotation", "archived", "destroyed"]
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Creation timestamp (ISO 8601)"
    },
    "valid_from": {
      "type": "string",
      "format": "date-time",
      "description": "Valid from timestamp (ISO 8601)"
    },
    "valid_until": {
      "type": "string",
      "format": "date-time",
      "description": "Valid until timestamp (ISO 8601)"
    },
    "rotation_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of rotations"
    },
    "access_policy": {
      "type": "object",
      "required": ["allowed_modules", "requires_approval", "max_usage_per_day"],
      "properties": {
        "allowed_modules": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "List of allowed module IDs"
        },
        "requires_approval": {
          "type": "boolean",
          "description": "Whether approval is required"
        },
        "max_usage_per_day": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum usage per day"
        }
      }
    }
  }
}
