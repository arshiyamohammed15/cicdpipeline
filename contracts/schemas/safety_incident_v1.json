{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "urn:zeroui:schemas:safety_incident:v1",
  "title": "SafetyIncident",
  "description": "Alert payload shared with EPC-4 and governance stakeholders.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "incident_id",
    "schema_version",
    "tenant_id",
    "workspace_id",
    "actor_id",
    "risk_class",
    "severity",
    "status",
    "related_request_ids",
    "policy_snapshot_id",
    "decision",
    "receipt_id",
    "dedupe_key",
    "timestamp_utc"
  ],
  "properties": {
    "incident_id": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]{12,64}$"
    },
    "schema_version": {
      "type": "string",
      "const": "v1"
    },
    "tenant_id": { "type": "string" },
    "workspace_id": { "type": "string" },
    "actor_id": { "type": "string" },
    "risk_class": {
      "type": "string",
      "enum": ["R1", "R2", "R3", "R4", "R5"]
    },
    "severity": {
      "type": "string",
      "enum": ["INFO", "WARN", "CRITICAL"]
    },
    "status": {
      "type": "string",
      "enum": ["OPEN", "ACKNOWLEDGED", "CLOSED"]
    },
    "related_request_ids": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1,
      "uniqueItems": true
    },
    "policy_snapshot_id": { "type": "string" },
    "policy_version_ids": {
      "type": "array",
      "items": { "type": "string" }
    },
    "decision": {
      "type": "string",
      "enum": ["ALLOWED", "BLOCKED", "TRANSFORMED", "DEGRADED"]
    },
    "receipt_id": { "type": "string" },
    "dedupe_key": { "type": "string" },
    "correlation_hints": {
      "type": "object",
      "additionalProperties": { "type": "string" }
    },
    "alert_payload": {
      "type": "object",
      "description": "Payload forwarded to EPC-4 `alert_safety_incident_v1`.",
      "additionalProperties": false,
      "required": ["schema_id", "risk_class", "severity"],
      "properties": {
        "schema_id": {
          "type": "string",
          "const": "alert_safety_incident_v1"
        },
        "risk_class": {
          "type": "string",
          "enum": ["R1", "R2", "R3", "R4", "R5"]
        },
        "severity": {
          "type": "string",
          "enum": ["INFO", "WARN", "CRITICAL"]
        },
        "incident_context": {
          "type": "object",
          "additionalProperties": { "type": ["string", "number", "boolean"] }
        }
      }
    },
    "timestamp_utc": { "type": "string", "format": "date-time" }
  }
}

